# 要件定義書

## 1. アプリ概要

**アプリ名**: CBT 再現演習
**目的**: JSTQB資格試験のCBT(Computer Based Testing)形式を模した環境で、本番に近い演習を行うこと。
**ターゲット**: JSTQB受験者（主に自分用）

## 2. 機能要件

### 2.1. 必須機能

- **問題読み込み機能**
  - 外部のCSVファイルを読み込み、問題データとして使用する。
  - **出題順序**: CSVファイルの行順（上から順番）に出題する。
- **演習モード**
  - 以下の2つのモードを選択可能とする。
        1. **一問一答モード**: 問題回答後、解説画面へ遷移する。解説画面では問題文、選択した回答、正解、解説を表示する。
        2. **本番模試モード**: 全ての問題を回答後に、まとめて採点結果と解説を表示する（各問題の振り返り時にも問題文を表示する）。
- **問題画面**
  - **画面レイアウト**:
    - **ヘッダー（上部）**: 青色（RGB(0, 109, 170)）の帯。右端に「時計マーク 残り時間」「リストマーク X / Y 問」を縦並びで配置。
    - **サブヘッダー**: ヘッダーの下に水色（RGB(128, 174, 225)、単色）の帯を表示。右端に「フラグアイコン 後で見直す」を配置。
      - アイコンは通常時「背景色と同化し白のアウトライン」、クリック（ON）状態で「黄色（255, 255, 0）の塗りつぶし＋黄色アウトライン」とする。
    - **メインエリア（中央）**: 問題文と選択肢（ラジオボタン）を表示。
    - **フッター（下部）**: ヘッダーと同色の青帯。右端に「← 前へ」「❖ 問題の選択」「次へ →」ボタンを横並びで配置（区切り線あり）。
      - ボタン背景は透明、白文字とする。
  - **確認ダイアログ（モーダル）**:
    - アプリ内のすべてのアラート（終了確認、未回答警告、時間切れ通知）は、ブラウザ標準のものではなく、統一されたデザインのカスタムモーダルを使用する。
    - **デザイン**: 画面中央に白背景で表示し、背景は半透明の黒で覆う。
    - **ボタン配置**: 「肯定/アクション（左）」 - 「キャンセル（右）」の配置とする。
  - ※「次へ→」ボタン押下により、回答の選択状態に関わらず次の画面へ遷移する。
  - 実際のJSTQB CBT試験画面のレイアウトを再現する。

### 2.2. データ要件

- **入力データ形式**: CSV
- **カラム構成**:
  - `question_text`: 問題文
  - `option_1` ~ `option_4`: 選択肢テキスト
  - `correct_option`: 正解の選択肢番号
  - `explanation`: 解説文（省略可。省略時は空文字として扱われる）
- **制約事項**:
  - ヘッダー行（1行目の列名定義）は必須。
  - 列の順序は自由（ヘッダー名で識別するため）。

### 2.3. 将来実装予定機能

- **制限時間タイマー**
  - 試験時間をカウントダウン表示する（一問一答モードの解説表示中は一時停止）。
  - **設定上限**: 9999分まで入力可能とする。
- **見直し機能**
  - 「後で見直す」フラグを立て、一覧で確認できる機能。
- **配点機能**
  - 問題ごとに配点（1点〜3点など）を設定できる機能。

## 3. 非機能要件

- **UI/UX**:
  - 「本番のCBT画面」の雰囲気を再現することを最優先する。
  - **配色**: 画面上下のヘッダー・フッターには特徴的な青い帯を配置する。
- **プラットフォーム**: PCブラウザ（Google Chrome推奨）。

## 4. 画面詳細要件

- **スタート画面**
  - **機能**:
    - **CSV読み込み**: デフォルト問題集のロード、または手元ファイルのアップロード。
    - **モード選択**: 「一問一答モード」と「本番模試モード」の選択。
    - **タイマー設定**:
      - 制限時間（分）を入力可能（最大9999分）。
      - **0分**: 時間制限なし（経過時間をカウントアップ）。
      - **1分以上**: 制限時間あり（残り時間をカウントダウン）。

- **問題画面**
  - **共通仕様**:
    - **ヘッダー**:
      - タイマー表示（残り時間 または 経過時間）。
      - 現在の問題番号 / 総問題数。
    - **サブヘッダー**: 「後で見直す」フラグ機能（本番模試モードのみ）。
  - **一問一答モードの挙動**:
    - **タイマー制御**: 解説表示中はタイマーを一時停止。「次へ」で再開。
    - **制限事項**: フラグ機能および「問題の選択」機能は無効。
    - **未回答警告**: 未回答で「次へ」を押した場合、カスタムモーダルで警告を表示（キャンセル可）。
  - **本番模試モードの挙動**:
    - **終了確認**: 最後の問題で「終了」を押した場合、カスタムモーダルで確認を表示。この際、タイマーは停止しない。
    - **タイムアップ**:
      - 残り時間が0になるとカスタムモーダルを表示。
      - 「終了」→ 結果画面へ。この際、即座に終了した場合は**残り時間を0秒（超過なし）**として扱う。
      - 「継続」→ モーダルを閉じ、マイナス時間で計測続行（赤字表示）。
    - **問題選択機能**: フッターボタンから一覧ポップアップを開き、任意の問題へジャンプ可能。

- **結果画面**
  - **機能**:
    - **スコア表示**: 正答数、正答率、合否メッセージ。
    - **経過時間表示**: 解答にかかった時間を表示（制限時間超過時は警告表示）。
    - **正誤一覧**: 3列構成（フラグ、問題番号、正誤マーク）のグリッドリスト表示。
    - **ナビゲーション**: タイトルに戻るボタン。

- **解説画面**: 一問一答モード用（正誤、問題文、選択肢、解説）。
- **結果一覧画面**: 本番模試モード完了後の詳細結果。

### 2.4. 追加機能 (Phase 6): 弱点克服機能

- **CSVエクスポート機能（弱点抽出）**
  - **目的**: 自分だけの弱点問題集を作成し、反復練習を可能にする。
  - **抽出条件の選択**: 結果画面に以下のチェックボックスを設け、エクスポート対象を選択可能にする。
    - [ ] **不正解問題** (デフォルト: ON)
    - [ ] **フラグ付き問題** (デフォルト: OFF)
  - **非活性制御**:
    - 対象となる問題が0件の場合（例: 全問正解時の「不正解問題」）、チェックボックスを自動的にOFFにし、非活性（グレーアウト）状態にする。余計な文字列（「なし」等）は付与しない。
    - 両方のチェックがOFFの場合は「エクスポート」ボタンを非活性にする。
  - **UX**: 不要なポップアップ（アラート）は排除し、スムーズな操作感を提供する。
  - **出力形式**: 入力時のCSV (`questions.csv`) と**完全に同一のフォーマット**（BOM付きUTF-8）。

- **一問一答モードへのフラグ機能拡張**
  - 学習中に気になった問題を即座にマークできるよう、全モードでフラグ機能を開放する。
  - **最終問題の挙動**: モードや正誤に関わらず、最終問題のボタン表記は「終了」とする。

- **結果画面のUX改善**
  - **フラグ操作**: 結果一覧のフラグアイコン（⚑）をクリックすることで、事後的にON/OFFを編集可能にする。
  - **視認性向上**: フラグアイコンのサイズを拡大し、クリックしやすいヒットエリアを確保する。
  - **操作ガイド**: 「※行クリックで解説表示 / ⚑クリックでフラグ切替」等の補助テキストを明記する。
