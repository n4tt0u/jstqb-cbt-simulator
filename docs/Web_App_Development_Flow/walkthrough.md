# 開発進捗ウォークスルー

## 実装済みの機能

### 1. 基礎機能

- [x] **プロジェクト作成**: React + Vite
- [x] **CSV読み込み**: `Papaparse` を使用して `public/questions.csv` をロード
- [x] **基本画面表示**: 問題文、選択肢（ラジオボタン）、ナビゲーションボタン

### 2. UIデザイン (CBT再現)

- [x] **全体レイアウト**: JSTQB CBT試験画面を模したレイアウト (Header, Main, Footer)
- [x] **ヘッダー/フッター**: 青帯、アイコン、透過ボタン。
- [x] **サブヘッダー**: 模試モード専用の「後で見直す」フラグ表示エリア。

### 3. モード・画面遷移

- [x] **スタート画面**:
  - CSVロード、モード選択。
  - **制限時間設定**: 0分(無制限)または任意の分数を設定可能。
- [x] **一問一答モード**:
  - 即時解説表示、未回答時の確認ダイアログ。
  - **タイマー制御**: 解説表示中は自動で一時停止。
  - **制限事項**: フラグ/問題選択ボタンは無効化。
- [x] **本番模試モード**: 全問解答後に結果画面へ遷移。
- [x] **結果画面**:
  - 総合スコア（正答数・率）、合否メッセージ。
  - **経過時間表示**: かかった時間を表示（制限時間超過時は赤字警告）。
  - 正誤一覧テーブル＆解説詳細ポップアップ。

### 4. 高度な機能

- [x] **問題選択機能** (模試モード用):
  - 一覧ポップアップ（回答状況・フラグ可視化）。
  - 任意の問題へジャンプ。
- [x] **高機能タイマー**:
  - **カウントダウン**: 設定時間から減算。
  - **カウントアップ**: 0分設定時は経過時間を計測。
  - **タイムアップ処理**: 0秒で「終了」か「継続」を選択可能。継続時はマイナス秒数で計測続行。
  - **デバッグ**: (本番リリースに向け削除済)

### 5. 保守・改善

- [x] **リファクタリング**:
  - タイマーロジックのHook化 (`useExamTimer`)。
  - モーダルコンポーネントの分離。
- [x] **バグ修正**:
  - タイマーの停止漏れや競合状態による誤作動を修正。
- [x] **仕様変更**:
  - 結果画面の「問題文」「回答」「正解」列を削除し、正誤のみのシンプル表示に変更。
  - 結果一覧をテーブル形式からグリッド（タイル）形式に変更し、視認性を向上。
  - ヘッダー・フッターの高さを調整し、情報表示（タイマー・問題数）を見やすく配置。
  - 問題選択画面および結果画面を、フラグ状況がひと目でわかる3列リスト形式にリデザイン。
  - 本番模試モード完了時に確認ダイアログを表示し、誤操作を防止。
  - アプリタイトルを「CBT 再現演習」に変更。
  - アプリ内の全アラート（終了確認、未回答警告、時間切れ）を共通のカスタムモーダルに置き換え。
  - ブラウザ標準のダイアログを廃止し、UXを統一（キャンセルボタンを右側に配置）。
  - カスタムモーダル化により、ダイアログ表示中もタイマーが停止しないよう改善。
  - 時間切れダイアログで「終了」を選択した場合、超過判定にならないよう修正（タイマー進行による誤差を吸収）。
  - 結果画面のレイアウト崩れ（不要な閉じタグによる構造破壊）を修正。

### 6. 弱点克服機能 (Phase 6)

- [x] **CSVエクスポート**:
  - 結果画面から「不正解問題」「フラグ付き問題」を抽出してCSVダウンロード。
  - **Excel互換性**: BOM (`\uFEFF`) を付与し、日本語文字化けを防止。
  - **柔軟な選択**: チェックボックスにより出力対象を自由に組み合わせ可能（対象0件時は自動非活性化）。
  - **UX改善**: 不要なポップアップを排除。
- [x] **フラグ機能の拡張**:
  - 一問一答モードでも「後で見直す」フラグを利用可能に。
  - 結果画面にてリスト上のフラグアイコンをクリックし、事後的にON/OFFを変更可能に（アイコン拡大・操作ガイド追加）。

### 7. リファクタリング・構成変更 (Phase 7)

- [x] **CSV仕様の簡素化**:
  - **ID列の廃止**: CSVファイル内でのID管理を不要に変更（読み込み時に行番号から自動採番）。
  - **デフォルトデータの整備**: 破損していた `questions.csv` を有効なサンプルデータ（3問、ID列なし、BOM付き）で再作成。
  - **柔軟性の向上**: ヘッダーさえあれば列順序は自由、解説列（`explanation`）は省略可能であることを仕様として確定。
  - **テンプレート提供**: スタート画面に「CSVテンプレートをダウンロード」リンクを追加。
- [x] **プロジェクト構成の整理**:
  - ドキュメントフォルダ (`docs`) をプロジェクトルート (`jstqb-cbt-simulator`) 配下に移動し、Git管理対象に統合。
  - Python仮想環境 (`.venv`) を作成し、開発用スクリプト実行環境を整備（`.gitignore` 設定済み）。

## 完了

すべての予定された機能実装および初期のバグ修正・改善が完了しました。
